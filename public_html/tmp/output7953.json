{"total":1,"records":[{"recid":1,"SCRIPTID":"1013","SCRIPTNAME":"TUpdateMe","SCRIPTCATEGORY":"Reserved","PURPOSE":"Script to run updates from master","INTERFACE":"Developer","VERSION":"1.0.4.6","RELEASE":"v1.0.0.1","CONTENT":"\/\/Andre: The updater class for the development environment\nclass TUpdateMe {\n  public $CDE;\n  public $request;\n  public $cdedev;\n  \n  \/\/Andre: the constructor for the UpdateMe script\n  function __construct ($CDE, $request, $cdedev) {\n    $this-&gt;CDE = $CDE; \/\/developer scripts\n\t$this-&gt;request = $request;\n\t$this-&gt;cdedev = $cdedev;\n  }\n  \n  \n  function __toString () {\n    return $this-&gt;draw();\n  }\n  \n  function draw () {\n    $html = &quot;&quot;; \n    $html .= h3 (&quot;Getting updates from server....&quot;);\n\n    \/\/Get the update script first ----\n\t\n\t$fetchupdates = file_get_contents (&quot;http:\/\/tina4.com\/master\/?interface=Update&amp;action=GetUpdates&quot;);\n\t\n\t$fetchupdates = json_decode ($fetchupdates);\n\t\n\t\n\t\n\t$li = array ();\n\tforeach ($fetchupdates as $fid =&gt; $fetchupdate) {\n\t  \n\t  $script = $this-&gt;CDE-&gt;get_value (0, &quot;select scriptid, scriptname, version, scriptcategory \n\t     from tblscript where scriptid = {$fetchupdate-&gt;scriptid} and release = ''{$this-&gt;request[&quot;release&quot;]}'' &quot;);\n\t  \n\t  \/\/print_r ( htmlentities ( urldecode ($fetchupdate-&gt;content) ) );\n\t  \n\t  if ( $script-&gt;SCRIPTNAME != $fetchupdate-&gt;scriptname ) {\n\t    \/\/legacy - see if we can find some scripts which exist by the same name\n\t\t\n\t\techo  &quot;select scriptid, scriptname, version, scriptcategory, interfaceid, purpose \n\t     from tblscript where scriptname = ''{$fetchupdate-&gt;scriptname}'' and release = ''{$this-&gt;request[&quot;release&quot;]}'' &quot;;\n\t\t\n\t\t$script = $this-&gt;CDE-&gt;get_value (0, &quot;select scriptid, scriptname, version, scriptcategory, interfaceid, purpose \n\t     from tblscript where scriptname = ''{$fetchupdate-&gt;scriptname}'' and release = ''{$this-&gt;request[&quot;release&quot;]}'' &quot;);\n\t    echo $script-&gt;SCRIPTNAME;\n\t\t\/\/we have found a script\n\t\tif ($script-&gt;SCRIPTID != &quot;&quot;) {\n\t\t  \/\/$cdedev = new cde_cdedev ($CDE, $_REQUEST, $outputpath=&quot;includes&quot;);\n\t\t    $li[] = li ( b ( $script-&gt;SCRIPTNAME. &quot; (&quot;. $script-&gt;VERSION.&quot;)&quot; ). &quot; ... found and updated  &quot; );\n\t\t\t\n\t\t\t$script   = new dev_script ($CDE, $this-&gt;request, $this-&gt;cdedev, $script-&gt;INTERFACEID);\n\t\t\t$script-&gt;update_script ($script-&gt;SCRIPTID, $fetchupdate-&gt;scriptname, \n\t\t\t$fetchupdate-&gt;scriptcategory, $script-&gt;PURPOSE, \n\t\t\turldecode ($fetchupdate-&gt;content), \n\t\t\t$script-&gt;STATUS, \n\t\t\t$moduleid=0, \n\t\t\t''tina4php'');\n\t\t}\n\t\t  else {\n\t\t  \/\/we must add this script into the current release\n \t      $li[] = li ( b ( $script-&gt;SCRIPTNAME. &quot; (&quot;. $script-&gt;VERSION.&quot;)&quot; ). &quot; ... added to the system &quot; );\n\t\t\n\t\t}\n\t\t\/\/make sure we don''t have any scripts of this version to release\n\t\t\n\t\t\n\t  }\n\t    else\n\t  if ($script-&gt;VERSION &lt; $fetchupdate-&gt;version) {\n\t    $li[] = li ( b ( $script-&gt;SCRIPTNAME. &quot; (&quot;. $script-&gt;VERSION.&quot;)&quot; ). &quot; ... updated to &quot;.$fetchupdate-&gt;version );\n\t\t\n\t    $sqlupdate = &quot;update tblscript set scriptname = ''{$fetchupdate-&gt;scriptname}'', scriptcategory = ?, content = ?, version = ? where scriptid = {$script-&gt;SCRIPTID}&quot;;\n\t\t$this-&gt;CDE-&gt;exec ($sqlupdate, $fetchupdate-&gt;scriptcategory, urldecode ($fetchupdate-&gt;content), $fetchupdate-&gt;version );\n\t\t\n\t  }\n\t}\n\t\n\t$html .= ul ($li );\n\treturn $html;\n  \n  }\n  \n  \n}  ","SCRIPTTYPE":"api","STATUS":"1","CREATEDBY":"Admin","EDITEDBY":"","LASTUSER":"","DATEMOD":"2014-04-25 14:05:18","DATECRT":"2014-04-25 14:01:54","MODULEID":"0"}]}